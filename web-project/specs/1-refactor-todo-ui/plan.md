# Implementation Plan: TODO List UI 重构与功能优化

**Feature ID**: 1-refactor-todo-ui  
**Created**: 2024-12-19  
**Status**: Draft  
**Spec**: [spec.md](./spec.md)

## Overview

本计划将重构待办事项应用的 UI，重点优化筛选按钮和编辑状态的视觉设计，并扩展优先级、搜索、批量操作等功能。所有实现遵循项目宪法原则：纯前端技术栈、渐进式实现、详细注释、用户体验优先。

## Architecture & Design Decisions

### Technical Stack
- **HTML5**: 语义化标签，保持现有结构
- **CSS3**: 使用现有 CSS 变量系统，增强样式一致性
- **原生 JavaScript (ES6+)**: 保持 IIFE 模式，避免全局污染
- **localStorage API**: 数据持久化，无需修改

### Design Patterns
- **组件化思维**: 将 UI 组件（按钮、输入框、标签）视为可复用单元
- **状态管理**: 使用应用状态对象管理 UI 状态（编辑模式、批量选择模式等）
- **事件委托**: 继续使用事件委托处理动态元素交互
- **渐进增强**: 先实现核心功能，再添加增强特性

### Data Model Changes

#### Task 实体扩展
```javascript
{
  id: string,              // 保持不变
  text: string,            // 保持不变
  done: boolean,           // 保持不变
  createdAt: number,       // 保持不变
  priority: number,        // 新增：1=低, 2=中, 3=高（默认 2）
  tags: string[],          // 新增：标签数组（可选，REQ-5）
  updatedAt: number        // 新增：更新时间戳（可选）
}
```

#### UI 状态管理
```javascript
{
  filter: 'all' | 'active' | 'done',  // 筛选状态
  sortMode: string,                     // 排序模式
  searchQuery: string,                  // 搜索关键词（REQ-6）
  editingTaskId: string | null,         // 正在编辑的任务 ID
  batchMode: boolean,                   // 批量选择模式（REQ-7）
  selectedTaskIds: string[]            // 选中的任务 ID 数组（REQ-7）
}
```

## Implementation Phases

### Phase 1: 核心 UI 优化（高优先级）
**目标**: 完成 REQ-1 和 REQ-2，解决用户反馈的主要 UI 问题

1. 筛选按钮 UI 重构（REQ-1）
2. 任务编辑状态 UI 优化（REQ-2）
3. 整体 UI 一致性检查（REQ-3 部分）

### Phase 2: 功能扩展 - 优先级和搜索（中优先级）
**目标**: 添加优先级可视化和搜索功能

1. 任务优先级功能（REQ-4）
2. 任务搜索功能（REQ-6）

### Phase 3: 增强功能（低优先级，可选）
**目标**: 根据时间和资源决定是否实现

1. 任务标签功能（REQ-5）
2. 批量操作功能（REQ-7）

## Task Breakdown

### Phase 1: 核心 UI 优化

#### Task 1.1: 重构筛选按钮样式
- **Description**: 重新设计筛选按钮（全部/未完成/已完成）的视觉样式
- **Files**: 
  - `style.css` - 添加/修改 `.filter-btn` 样式
  - `todo.html` - 确保 HTML 结构正确（可能需要微调）
- **实现细节**:
  - 激活状态：主色调背景（`var(--primary)`）+ 主色调边框
  - 未激活状态：浅色背景（`var(--bg-light)` 或 `#f5f5f7`）+ 浅色边框（`var(--border)`）
  - 悬停效果：未激活按钮悬停时背景色加深或边框变为主色调
  - 触摸目标：最小 44x44px（通过 padding 控制）
  - 间距：按钮之间 8-12px gap
  - 字体：14-16px，与整体设计一致
- **Dependencies**: 无
- **Acceptance**: 
  - [ ] 激活按钮有明显的视觉区分（背景色+边框）
  - [ ] 悬停效果流畅自然
  - [ ] 移动设备上易于点击
  - [ ] 与整体设计系统一致

#### Task 1.2: 优化任务编辑状态 UI
- **Description**: 改进编辑模式的用户界面，添加保存/取消按钮
- **Files**:
  - `scripts/todo.js` - 修改 `startEditing()` 函数
  - `style.css` - 添加编辑状态相关样式
- **实现细节**:
  - 编辑输入框：主色调边框（`var(--primary)`），清晰的视觉边界
  - 添加保存和取消按钮（使用 `.btn-primary` 和 `.btn-ghost` 样式）
  - 按钮位置：输入框下方或右侧
  - 键盘快捷键：Enter 保存（已实现），Esc 取消（已实现）
  - 过渡动画：200-300ms 淡入/缩放效果
  - 自动聚焦并选中文本（已实现）
- **Dependencies**: Task 1.1（确保按钮样式一致）
- **Acceptance**:
  - [ ] 编辑状态有明显的视觉指示
  - [ ] 保存和取消按钮清晰可见
  - [ ] 键盘快捷键正常工作
  - [ ] 过渡动画流畅

#### Task 1.3: 统一 UI 设计语言
- **Description**: 确保所有 UI 元素遵循统一的设计规范
- **Files**:
  - `style.css` - 审查和统一所有按钮、输入框样式
  - `todo.html` - 确保 HTML 结构一致
- **实现细节**:
  - 审查所有按钮样式，确保使用统一的设计变量
  - 统一输入框样式（搜索框、任务输入框、编辑输入框）
  - 统一列表项间距和视觉层次
  - 响应式设计检查（移动设备适配）
- **Dependencies**: Task 1.1, Task 1.2
- **Acceptance**:
  - [ ] 所有按钮样式一致
  - [ ] 所有输入框样式一致
  - [ ] 移动设备上表现良好

### Phase 2: 功能扩展

#### Task 2.1: 实现任务优先级功能
- **Description**: 添加优先级设置和可视化显示
- **Files**:
  - `scripts/todo.js` - 添加优先级相关函数
  - `style.css` - 添加优先级标签样式
  - `todo.html` - 可能需要添加优先级选择 UI
- **实现细节**:
  - 数据模型：Task 对象添加 `priority` 字段（1=低, 2=中, 3=高，默认 2）
  - 优先级标签：彩色标签显示"高/中/低"
    - 高优先级：红色系（如 `#ef4444` 或 `#dc2626`）
    - 中优先级：黄色/橙色系（如 `#f59e0b` 或 `#f97316`）
    - 低优先级：绿色/蓝色系（如 `#10b981` 或 `#3b82f6`）
  - 优先级设置：点击标签或下拉菜单修改优先级
  - 排序功能：扩展 `getViewTodos()` 支持按优先级排序
  - 迁移现有数据：为现有任务设置默认优先级（中优先级）
- **Dependencies**: Phase 1 完成
- **Acceptance**:
  - [ ] 任务可以设置优先级
  - [ ] 优先级通过彩色标签显示
  - [ ] 可以通过界面修改优先级
  - [ ] 排序功能支持优先级

#### Task 2.2: 实现任务搜索功能
- **Description**: 添加实时搜索功能，支持关键词匹配和高亮
- **Files**:
  - `scripts/todo.js` - 添加搜索相关函数
  - `style.css` - 添加搜索框和高亮样式
  - `todo.html` - 添加搜索输入框
- **实现细节**:
  - 搜索输入框：添加到控制区域，样式与整体设计一致
  - 实时过滤：监听 `input` 事件，实时更新任务列表
  - 文本匹配：不区分大小写，使用 `includes()` 或正则表达式
  - 高亮显示：匹配文本同时使用背景色高亮和文本颜色变化
    - 背景色：黄色或浅色（如 `#fef08a` 或 `#fef3c7`）
    - 文本颜色：主色调或对比色（如 `var(--primary)`）
  - 空状态：搜索无结果时显示友好提示
  - 搜索与筛选结合：搜索在筛选后的结果中进行
- **Dependencies**: Phase 1 完成
- **Acceptance**:
  - [ ] 搜索框位置醒目
  - [ ] 实时过滤正常工作
  - [ ] 关键词高亮显示（背景色+文本颜色）
  - [ ] 无结果时显示提示

### Phase 3: 增强功能（可选）

#### Task 3.1: 实现任务标签功能
- **Description**: 允许用户为任务添加标签
- **Files**:
  - `scripts/todo.js` - 添加标签相关函数
  - `style.css` - 添加标签样式
  - `todo.html` - 添加标签管理 UI
- **实现细节**:
  - 数据模型：Task 对象添加 `tags` 字段（字符串数组）
  - 标签显示：在任务列表中显示标签（小标签样式）
  - 标签管理：创建、编辑、删除标签
  - 标签筛选：扩展筛选功能，支持按标签筛选
- **Dependencies**: Phase 2 完成
- **Acceptance**: 按 REQ-5 验收标准

#### Task 3.2: 实现批量操作功能
- **Description**: 允许用户批量选择和操作任务
- **Files**:
  - `scripts/todo.js` - 添加批量操作相关函数
  - `style.css` - 添加批量模式相关样式
  - `todo.html` - 添加批量操作按钮和工具栏
- **实现细节**:
  - 批量选择模式：点击"批量操作"按钮进入模式
  - 复选框显示：批量模式下每个任务显示复选框
  - 操作工具栏：显示批量完成、批量删除等按钮
  - 批量操作：遍历选中的任务 ID，执行相应操作
  - 确认提示：批量删除需要确认
  - 退出模式：点击"取消"或"退出批量模式"按钮
- **Dependencies**: Phase 2 完成
- **Acceptance**: 按 REQ-7 验收标准

## Testing Strategy

### 手动测试清单

#### UI 优化测试
- [ ] 筛选按钮激活状态正确显示
- [ ] 筛选按钮悬停效果正常
- [ ] 编辑状态 UI 清晰美观
- [ ] 保存/取消按钮正常工作
- [ ] 键盘快捷键（Enter/Esc）正常工作
- [ ] 移动设备上触摸目标合适

#### 功能测试
- [ ] 优先级设置和显示正常
- [ ] 优先级排序功能正常
- [ ] 搜索功能实时过滤正常
- [ ] 搜索高亮显示正确
- [ ] 搜索无结果时显示提示
- [ ] 批量选择模式正常进入/退出
- [ ] 批量操作功能正常

#### 兼容性测试
- [ ] Chrome 浏览器正常
- [ ] Firefox 浏览器正常
- [ ] Safari 浏览器正常
- [ ] Edge 浏览器正常
- [ ] 移动设备（iOS Safari、Chrome Mobile）正常

#### 数据持久化测试
- [ ] 刷新页面后数据不丢失
- [ ] 优先级数据正确保存
- [ ] 标签数据正确保存（如果实现）

### 性能测试
- [ ] 页面加载时间 < 100ms（用户感知）
- [ ] 交互响应时间 < 100ms
- [ ] 大量任务（100+）时性能可接受

## Risk & Mitigation

### 风险 1: 现有功能回归
- **风险**: 重构过程中可能破坏现有功能
- **缓解**: 
  - 分阶段实现，每完成一个任务就测试
  - 保持现有代码结构，只修改必要的部分
  - 使用版本控制，可以快速回滚

### 风险 2: 数据迁移问题
- **风险**: 添加新字段（priority、tags）时，现有数据可能不兼容
- **缓解**:
  - 在 `loadTodos()` 函数中添加数据迁移逻辑
  - 为现有任务设置默认值（priority=2，tags=[]）
  - 使用 try-catch 处理数据解析错误

### 风险 3: 样式冲突
- **风险**: 新样式可能与现有样式冲突
- **缓解**:
  - 使用 CSS 变量保持一致性
  - 使用特定的类名避免冲突
  - 在浏览器开发者工具中测试

### 风险 4: 移动设备适配
- **风险**: 新 UI 在移动设备上可能显示不佳
- **缓解**:
  - 使用响应式设计（flexbox、媒体查询）
  - 确保触摸目标足够大（44x44px）
  - 在真实移动设备上测试

## Code Quality Guidelines

### 注释要求
- 所有新增函数必须有详细的中文注释
- 复杂逻辑必须提供算法说明
- CSS 样式必须有说明性注释

### 代码组织
- 保持现有 IIFE 结构
- 函数按功能分组
- 使用有意义的变量和函数名

### 样式规范
- 使用 CSS 变量（`var(--primary)` 等）
- 遵循现有的命名约定
- 保持响应式设计

## Implementation Order

1. **Task 1.1**: 筛选按钮 UI 重构（最高优先级，解决用户反馈的主要问题）
2. **Task 1.2**: 任务编辑状态 UI 优化（最高优先级，解决用户反馈的主要问题）
3. **Task 1.3**: 统一 UI 设计语言（确保一致性）
4. **Task 2.1**: 任务优先级功能（中优先级，功能扩展）
5. **Task 2.2**: 任务搜索功能（中优先级，功能扩展）
6. **Task 3.1**: 任务标签功能（低优先级，可选）
7. **Task 3.2**: 批量操作功能（低优先级，可选）

## Success Metrics

- 筛选按钮 UI 得到显著改善（视觉对比）
- 编辑状态 UI 清晰直观（90% 用户能顺利完成编辑）
- 所有新功能正常工作，不影响现有功能
- 页面加载和交互响应时间 < 100ms
- 代码包含详细注释，符合项目宪法要求

